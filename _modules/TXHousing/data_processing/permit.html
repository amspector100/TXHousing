

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TXHousing.data_processing.permit &mdash; TXHousing 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> TXHousing
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../utilities.html">Autogenerated Documentation for utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_processing.html">Autogenerated Documentation for data_processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analysis.html">Autogenerated Documentation for analysis package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TXHousing</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>TXHousing.data_processing.permit</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for TXHousing.data_processing.permit</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span>

<span class="c1"># Filepaths</span>
<span class="n">austin_permit_path</span> <span class="o">=</span> <span class="s1">&#39;data/Permit/austin_construction_permits.csv&#39;</span>

<span class="n">dallas_permit_path</span> <span class="o">=</span> <span class="s1">&#39;data/Permit/dallas_construction_permits.csv&#39;</span>
<span class="n">dpm_save_path</span> <span class="o">=</span> <span class="s2">&quot;shared_data/dallas_corrected_permits/dallas_permits_corrected.shp&quot;</span>

<span class="n">houston_structural_permits_path</span> <span class="o">=</span> <span class="s2">&quot;data/Permit/Houston_Structural_Permits/Permits_wm_Structural.shp&quot;</span>
<span class="n">houston_demolition_permits_path</span> <span class="o">=</span> <span class="s2">&quot;data/Permit/Houston_Demolition_Permits/Demolition_ILMS_Code_SD.shp&quot;</span>
<span class="n">houston_permit_statuses_path</span> <span class="o">=</span> <span class="s1">&#39;shared_data/houston_permit_statuses.csv&#39;</span>
<span class="n">backup_houston_permit_statuses_path</span> <span class="o">=</span> <span class="s1">&#39;shared_data/houston_permit_statuses_backup.csv&#39;</span>

<span class="c1"># Austin -----------------------------------</span>

<div class="viewcode-block" id="process_austin_permit_data"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.permit.process_austin_permit_data">[docs]</a><span class="k">def</span> <span class="nf">process_austin_permit_data</span><span class="p">(</span><span class="n">searchfor</span><span class="p">,</span> <span class="n">permittypedesc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">workclass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">earliest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param searchfor: List of strings to search for in the &#39;PermitClass&#39; and &#39;Description&#39; columns. Often it&#39;s worth</span>
<span class="sd">        explicitly passing in permit classes, i.e. searchfor = [&#39;101 single family houses&#39;].</span>
<span class="sd">    :param permittypedesc: The permittypedesc to match. Ex: &quot;Building Permit.&quot;</span>
<span class="sd">    :param workclass: Workclass to match. Ex: &quot;New&quot;</span>
<span class="sd">    :param earliest: Earliest date to consider (inclusive). Data runs from 1971-2018.</span>
<span class="sd">    :param latest: Latest date to consider (inclusive). Data runs from 1971-2018.</span>
<span class="sd">    :return: GeoDataFrame of subsetted permit data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">permit_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">austin_permit_path</span><span class="p">)</span>

    <span class="c1"># Initial subset</span>
    <span class="n">construction</span> <span class="o">=</span> <span class="n">permit_data</span>
    <span class="k">if</span> <span class="n">permittypedesc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">construction</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">permit_data</span><span class="p">[</span><span class="s1">&#39;PermitTypeDesc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">permittypedesc</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">workclass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">construction</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">permit_data</span><span class="p">[</span><span class="s1">&#39;WorkClass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">workclass</span><span class="p">)]</span>

    <span class="c1"># Get right timeframe</span>
    <span class="k">if</span> <span class="n">earliest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">construction</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">construction</span><span class="p">[</span><span class="s1">&#39;CalendarYearIssued&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">earliest</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="n">latest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">construction</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">construction</span><span class="p">[</span><span class="s1">&#39;CalendarYearIssued&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">latest</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">def</span> <span class="nf">to_lowercase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Now subset to just include entries where one of the &#39;searchfor&#39; strings is in either the description or permit</span>
    <span class="c1">#  class column. Can use this to search for either multifamily or single family, or anything specific really.</span>
    <span class="c1"># Best to search based on permit class, see below.</span>
    <span class="n">searchfor</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">searchfor</span><span class="p">]</span>
    <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;PermitClass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;PermitClass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">to_lowercase</span><span class="p">)</span>
    <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">to_lowercase</span><span class="p">)</span>
    <span class="n">construction</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">construction</span><span class="p">[</span><span class="s1">&#39;PermitClass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">searchfor</span><span class="p">)))</span> <span class="o">|</span>
                                    <span class="p">(</span><span class="n">construction</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">searchfor</span><span class="p">))),</span> <span class="p">:]</span>

    <span class="k">def</span> <span class="nf">return_point</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
        <span class="c1"># series[0] is long, series[1] is lat</span>
        <span class="k">return</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">series</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Now process geometry</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">construction</span><span class="p">[[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Latitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">return_point</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">construction</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">construction</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">points</span><span class="p">)</span>
    <span class="n">construction</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;epsg:4326&#39;</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">construction</span></div>

<span class="c1"># Dallas -----------------------------------------------</span>

<div class="viewcode-block" id="process_dallas_permit_data"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.permit.process_dallas_permit_data">[docs]</a><span class="k">def</span> <span class="nf">process_dallas_permit_data</span><span class="p">(</span><span class="n">permit_types</span><span class="p">,</span> <span class="n">earliest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initially process raw dallas permit data. However, the raw permit data has some inaccuracies, and</span>
<span class="sd">    it&#39;s best to simply read the corrected data from dpm_save_path.</span>

<span class="sd">    :param permit_types: List of permit types to filter for. Will only consider rows where the permit type is one of</span>
<span class="sd">        these permit types.</span>
<span class="sd">    :param earliest: Earliest date to consider. Data runs from 2011-2016. Defaults to None.</span>
<span class="sd">    :param latest: Latest date to consider. Data runs from 2011-2016. Defaults to None.</span>
<span class="sd">    :raises: UserWarning; some permit data is incorrect. Construction data has been corrected, and the corrected data is</span>
<span class="sd">        stored at &#39;dpm_save_path&#39; as listed in the inputs.py file.</span>
<span class="sd">    :return: GeoDataFrame of subsetted permit data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Some permit data is incorrect. Construction permit data has been corrected and the corrected data </span>
<span class="s2">     should be stored at &quot;dpm_save_path&quot; file. Instead of running this function, you should simply read that data using</span>
<span class="s2">     the get_corrected_dallas_permit_data function.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">permit_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dallas_permit_path</span><span class="p">)</span>

    <span class="c1"># Get date</span>
    <span class="k">def</span> <span class="nf">get_year</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="n">permit_data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">permit_data</span><span class="p">[</span><span class="s1">&#39;Issued Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_year</span><span class="p">)</span>

    <span class="c1"># subset by year and permit type, then return</span>
    <span class="n">construction</span> <span class="o">=</span> <span class="n">permit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">permit_data</span><span class="p">[</span><span class="s1">&#39;Permit Type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">permit_types</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">earliest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">construction</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">construction</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">earliest</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">latest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">construction</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">construction</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">latest</span><span class="p">]</span>

    <span class="c1"># Get points</span>
    <span class="k">def</span> <span class="nf">return_point</span><span class="p">(</span><span class="n">location</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">long</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>

    <span class="c1"># Geocoding fails for 5000/220,000 locations, which have addresses but not lat/long. Could improve this using google API</span>
    <span class="c1"># or using a dictionary of addresses:lat/long (because some addresses are repeated) but a bit pressed for time right now.</span>
    <span class="c1"># Fails for about 15% of construction sites.</span>
    <span class="k">def</span> <span class="nf">is_geocoded</span><span class="p">(</span><span class="n">location</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">return_point</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="n">construction</span> <span class="o">=</span> <span class="n">construction</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">construction</span><span class="p">[</span><span class="s1">&#39;GeoLocation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_geocoded</span><span class="p">)]</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">construction</span><span class="p">[</span><span class="s1">&#39;GeoLocation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">return_point</span><span class="p">)</span>
    <span class="n">construction</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">construction</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">points</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">construction</span></div>


<div class="viewcode-block" id="correct_dallas_permit_data"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.permit.correct_dallas_permit_data">[docs]</a><span class="k">def</span> <span class="nf">correct_dallas_permit_data</span><span class="p">(</span><span class="n">api_key</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">address_cache_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dpm_save_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">re_geocode</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Corrects and caches dallas construction permit data. This function worked the first time but is a untested</span>
<span class="sd">    since then. I would not recommend running this again, as it requires getting a google maps account and that&#39;s been</span>
<span class="sd">    getting harder over time. Instead, it&#39;s easier to pull the geocoded addresses from</span>
<span class="sd">    https://github.com/amspector100/TXHousing/tree/reorganization/shared_data</span>

<span class="sd">    :param address_cache_path: The path at which to cache the geocoded addresses.</span>
<span class="sd">    :param dpm_save_path: The path at which to cache the entirely correct permit data.</span>
<span class="sd">    :param re_geocode: If true, re-pull all the data from the google maps API. Else, just use the cached address path.</span>
<span class="sd">    :type re_geocode: Boolean</span>
<span class="sd">    :return: None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">googlemaps</span>
    <span class="kn">import</span> <span class="nn">shapely</span>
    <span class="kn">from</span> <span class="nn">tqdm</span> <span class="k">import</span> <span class="n">tqdm</span>

    <span class="c1"># Retrieve api key - to get one, follow the directions listed at https://github.com/googlemaps/google-maps-services-python</span>
    <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">api_key_path</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/amspe/Desktop/gmaps_apikey.txt&quot;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">api_key_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">api_key</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;You need to register with google to receive a geocoding API key - see directions at https://github.com/googlemaps/google-maps-services-python&#39;</span><span class="p">)</span>

    <span class="c1"># Instantiate gmaps client</span>
    <span class="n">gmaps</span> <span class="o">=</span> <span class="n">googlemaps</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_latlong</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Get lat and long of an address.</span>

<span class="sd">        :param address: String, address. Separated by commas. Example: &#39;1600 Amphitheatre Parkway, Mountain View, CA&#39;</span>
<span class="sd">        :return: list(lat, long).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geocode_result</span> <span class="o">=</span> <span class="n">gmaps</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">geocode_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">geocode_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">geocode_dallas_permit_data</span><span class="p">(</span><span class="n">permit_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Building (BU) Single Family  New Construction&#39;</span><span class="p">,</span> <span class="s1">&#39;Building (BU) Multi Family  New Construction&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        When latitudes and longitudes are repeated exactly in the permit data, we assume flag them as possibly incorrect.</span>
<span class="sd">        Then, we use the google maps api to re-geocode them. (We cannot geocode every permit as google maps has use limits).</span>
<span class="sd">        Note that after the geocode data has been scraped, this will save the geocode data under the save path repeatedly, so that even if</span>
<span class="sd">        an error is thrown down the line, you do not need to re-geocode the bad data points.</span>

<span class="sd">        :param permit_types: Subset data to only include permit types. Note a lot of multifamily units have repeat geocodes</span>
<span class="sd">        (which makes sense) so you run the risk of using too many geocode requests if you put in multifamily new construction repeatedly.</span>
<span class="sd">        :param save_path: Save to this path. Should be a shapefile path.</span>
<span class="sd">        :return: Corrected dallas permit data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bigtime0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Get permit data.</span>
        <span class="n">permit_data</span> <span class="o">=</span> <span class="n">process_dallas_permit_data</span><span class="p">(</span><span class="n">permit_types</span> <span class="o">=</span> <span class="n">permit_types</span><span class="p">)</span>

        <span class="c1"># Subset based on duplicate lat/long coordinates. This is the part we will correct. Save index.</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">permit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">permit_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">coords</span><span class="p">[:][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>

        <span class="c1"># Only consider parts with valid addresses. Can&#39;t do anything about parts with invalid addresses.</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Street Address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>

        <span class="c1"># Get unique street addresses. This will reduce the number of necessary geocoding calls. Should be around length 900 for</span>
        <span class="c1"># new sf and mf homes.</span>
        <span class="n">addresses</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Street Address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">address_dic</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting to geocode at time </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">bigtime0</span><span class="p">))</span>

        <span class="c1"># Loop through. This is a slow method but it is INTENDED to be slow because you can only request 50 geocodes per second.</span>
        <span class="k">for</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">addresses</span><span class="p">):</span>

            <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># Format address by converting to string (just in case) and adding Dallas, TX info</span>
            <span class="n">address</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;Dallas, TX&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">address</span><span class="p">:</span>
                <span class="n">long_address</span> <span class="o">=</span> <span class="n">address</span> <span class="o">+</span> <span class="s1">&#39;, Dallas, TX&#39;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">address_dic</span><span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_latlong</span><span class="p">(</span><span class="n">long_address</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, with long_address </span><span class="si">{}</span><span class="s1">, is a bad address - continuing but you might have to another loop.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">long_address</span><span class="p">))</span>

            <span class="c1"># Wait if process is working too fast to avoid ratetimeerrors.</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span> <span class="o">&gt;</span> <span class="mf">0.02</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">time0</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">address_dic</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">address_cache_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">finish_geocoding</span><span class="p">(</span><span class="n">permit_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Building (BU) Single Family  New Construction&#39;</span><span class="p">,</span> <span class="s1">&#39;Building (BU) Multi Family  New Construction&#39;</span><span class="p">]):</span>

        <span class="c1"># Start over from this point to make everything dependent on the cached data and not the geocoding.</span>
        <span class="n">address_dictionary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">address_cache_path</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="c1"># Reget subset</span>
        <span class="n">permit_data</span> <span class="o">=</span> <span class="n">process_dallas_permit_data</span><span class="p">(</span><span class="n">permit_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Building (BU) Single Family  New Construction&#39;</span><span class="p">,</span> <span class="s1">&#39;Building (BU) Multi Family  New Construction&#39;</span><span class="p">])</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">permit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">permit_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">coords</span><span class="p">[:][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Street Address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Street Address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">address_dictionary</span><span class="p">]))]</span>

        <span class="c1"># Map to new addresses. There are also some rows which will probably show up as if they&#39;re in Connecticut due</span>
        <span class="c1"># to address parsing error on Google&#39;s end - it will offer you the chance to drop these points.</span>
        <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Street Address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">address_dictionary</span><span class="p">)</span>
        <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">subset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;coords&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">permit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">subset</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">subset</span>


        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8825</span><span class="p">,</span> <span class="mi">8828</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">permit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rows</span><span class="p">])</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Do you want to drop the rows which were just printed? They look like they&#39;re in Connecticut. If so, type &#39;yes&#39;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="n">permit_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


        <span class="n">permit_data</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">dpm_save_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">re_geocode</span><span class="p">:</span>
        <span class="n">geocode_dallas_permit_data</span><span class="p">()</span>
    <span class="n">finish_geocoding</span><span class="p">()</span></div>

<div class="viewcode-block" id="get_corrected_dallas_permit_data"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.permit.get_corrected_dallas_permit_data">[docs]</a><span class="k">def</span> <span class="nf">get_corrected_dallas_permit_data</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">dpm_save_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get processed &amp; corrected Dallas permit data.</span>

<span class="sd">    :param path: the path to read the data from.</span>
<span class="sd">    :return: GDF of Construciton permit data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Old and new column names (new ones are cut off)</span>
    <span class="n">shapefile_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Permit Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Permit Typ&#39;</span><span class="p">,</span> <span class="s1">&#39;Issued Dat&#39;</span><span class="p">,</span> <span class="s1">&#39;Mapsco&#39;</span><span class="p">,</span> <span class="s1">&#39;Contractor&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">,</span> <span class="s1">&#39;Work Descr&#39;</span><span class="p">,</span> <span class="s1">&#39;Land Use&#39;</span><span class="p">,</span> <span class="s1">&#39;Street Add&#39;</span><span class="p">,</span> <span class="s1">&#39;GeoLocatio&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Zip Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>

    <span class="n">original_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Permit Number&#39;</span><span class="p">,</span> <span class="s1">&#39;Permit Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Issued Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Mapsco&#39;</span><span class="p">,</span> <span class="s1">&#39;Contractor&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">,</span> <span class="s1">&#39;Work Description&#39;</span><span class="p">,</span> <span class="s1">&#39;Land Use&#39;</span><span class="p">,</span> <span class="s1">&#39;Street Address&#39;</span><span class="p">,</span>
       <span class="s1">&#39;GeoLocation&#39;</span><span class="p">,</span> <span class="s1">&#39;Zip Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>

    <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">new</span><span class="p">,</span> <span class="n">old</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">shapefile_columns</span><span class="p">,</span> <span class="n">original_columns</span><span class="p">):</span>
        <span class="n">dictionary</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span>

    <span class="n">permit_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">permit_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictionary</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">permit_data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Corrected dallas permit data column names have been cut off by shapefile editor&#39;</span><span class="p">)</span>

    <span class="n">permit_data</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">permit_data</span></div>


<span class="c1"># Houston ---------------------------------------------------------------------</span>

<div class="viewcode-block" id="process_houston_permit_data"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.permit.process_houston_permit_data">[docs]</a><span class="k">def</span> <span class="nf">process_houston_permit_data</span><span class="p">(</span><span class="n">searchfor</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;NEW S.F.&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW SF&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW SINGLE&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW TOWNHOUSE&#39;</span><span class="p">],</span>
                                <span class="n">searchin</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PROJ_DESC&#39;</span><span class="p">],</span>
                                <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;structural&#39;</span><span class="p">,</span>
                                <span class="n">earliest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Process houston permit data. Note that houston permit data does not specify whether housing is new or not, this</span>
<span class="sd">    requires parsing the descriptions to figure out whether housing is new sf/new mf housing. Thankfully the descriptions</span>
<span class="sd">    are formulaic so this is not too hard to do.</span>

<span class="sd">    :param searchfor: A list of keywords to search for, i.e. [&#39;NEW S.F.&#39;, &#39;NEW SF&#39;, &#39;NEW SINGLE&#39;, &#39;NEW TOWNHOUSE&#39;]).</span>
<span class="sd">        To subset to only include new construction, each string should start with &#39;NEW &#39;.</span>
<span class="sd">    :param searchin: The columns to search in. Defualts to [&#39;PROJ_DESC&#39;], project description. Note that the function</span>
<span class="sd">        will return rows where ANY of the columns specified by &#39;searchin&#39; contain ANY of the keywords in &#39;searchfor&#39;.</span>
<span class="sd">    :param kind: The kind of permit data to read in. Defaults to &#39;structural&#39;, can either by &#39;structural&#39;</span>
<span class="sd">        or &#39;demolition&#39;</span>
<span class="sd">    :param earliest: Earliest date to consider.</span>
<span class="sd">    :param latest: Latest date to consider.</span>
<span class="sd">    :return: GeoDataFrame of subsetted permit data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load data</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;structural&#39;</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">houston_structural_permits_path</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;demolition&#39;</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">houston_demolition_permits_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&quot;kind&quot; arg must either equal &quot;demolition&quot; or &quot;structural&quot;, not &quot;</span><span class="si">{}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kind</span><span class="p">))</span>

    <span class="n">permit_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">permit_data</span> <span class="o">=</span> <span class="n">permit_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SITUS_ZIP_&#39;</span><span class="p">:</span> <span class="s1">&#39;Zipcode&#39;</span><span class="p">})</span>  <span class="c1"># Already has 100% complete zipcode information.</span>
    <span class="n">permit_data</span> <span class="o">=</span> <span class="n">permit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">permit_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)]</span>

    <span class="c1"># Ignore repeated plans</span>
    <span class="n">permit_data</span> <span class="o">=</span> <span class="n">permit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">permit_data</span><span class="p">[</span><span class="s1">&#39;PROJ_DESC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;REPEAT PLAN&#39;</span><span class="p">)]</span>

    <span class="c1"># Search for &#39;searchfor&#39; args in the specified columns</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">permit_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">searchin</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">permit_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">searchfor</span><span class="p">))</span>
    <span class="n">subsetted_data</span> <span class="o">=</span> <span class="n">permit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">flags</span><span class="p">]</span>

    <span class="c1"># Process dates. Note that data runs from 1988 to 2018.</span>
    <span class="n">subsetted_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subsetted_data</span><span class="p">[</span><span class="s1">&#39;APPLN_DATE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">earliest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">subsetted_data</span> <span class="o">=</span> <span class="n">subsetted_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">subsetted_data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">earliest</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">latest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">subsetted_data</span> <span class="o">=</span> <span class="n">subsetted_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">subsetted_data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">latest</span><span class="p">]</span>

    <span class="c1"># Process whether permit has been approved yet (using scraped data)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">houston_permit_statuses_path</span><span class="p">):</span>
        <span class="n">approvals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">houston_permit_statuses_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">approvals</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">approvals</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&#39;Cannot retrieve accurate approval status for houston permit data because it has not been</span>
<span class="s2">         scraped or downloaded. Try pulling it from https://github.com/amspector100/TXHousing/tree/reorganization/shared_data</span>
<span class="s2">         or alternatively run the scrape_houston_permit_data function.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Merge</span>
    <span class="n">subsetted_data</span><span class="p">[</span><span class="s1">&#39;Approval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subsetted_data</span><span class="p">[</span><span class="s1">&#39;PROJECT_NO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">approvals</span><span class="p">[</span><span class="s1">&#39;Approval&#39;</span><span class="p">])</span>

    <span class="c1"># Return</span>
    <span class="k">return</span> <span class="n">subsetted_data</span></div>

<div class="viewcode-block" id="scrape_houston_permit_data"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.permit.scrape_houston_permit_data">[docs]</a><span class="k">def</span> <span class="nf">scrape_houston_permit_data</span><span class="p">(</span><span class="n">target_path</span> <span class="o">=</span> <span class="n">houston_permit_statuses_path</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;structural&#39;</span><span class="p">,</span> <span class="n">backup_path</span> <span class="o">=</span> <span class="n">backup_houston_permit_statuses_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scrapes Houston permit approval data and writes it to the target_path as well as the backup_path. It will never</span>
<span class="sd">    overwrite any pre-existing csv files - it only appends information to csvs. This requires proper installation of the</span>
<span class="sd">    headless chrome webdriver and takes a lot of time (~2 hours), so it&#39;s probably best to pull the information from</span>
<span class="sd">    https://github.com/amspector100/TXHousing/tree/reorganization/shared_data instead of calling this function.</span>

<span class="sd">    :param target_path: The path to write the scraped data to.</span>
<span class="sd">    :param kind: The kind of permit data to scrape. Can either be &#39;structural&#39; or &#39;demolition&#39;.</span>
<span class="sd">    :param backup_path: The path to write the scraped data to as a backup in case something happens to the original.</span>
<span class="sd">    :returns: None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">selenium</span> <span class="k">import</span> <span class="n">webdriver</span>
    <span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="k">import</span> <span class="n">Keys</span>
    <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">Pool</span>
    <span class="kn">import</span> <span class="nn">sys</span>

    <span class="k">def</span> <span class="nf">get_project_statuses</span><span class="p">(</span><span class="n">project_numbers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scrapes status of permit projects from Houston website.</span>
<span class="sd">        :param project_numbers: List of project numbers (strings).</span>
<span class="sd">        :return: A pandas series. The index is the project numbers, the values are the approval status.</span>
<span class="sd">        0 = not approved, 1 = approved, Na = no information listed on the website.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Open webdriver and initialize</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
        <span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--headless&#39;</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--log-level=3&#39;</span><span class="p">)</span>
        <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">chrome_options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.pdinet.pd.houstontx.gov/cohilms/webs/Plan_LookUp.asp&#39;</span>

        <span class="k">for</span> <span class="n">project_number</span> <span class="ow">in</span> <span class="n">project_numbers</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">counter</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> process has finished </span><span class="si">{}</span><span class="s1"> ids&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">counter</span><span class="p">))</span>

            <span class="c1"># Some very crude error handling</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Go to website</span>
                <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

                <span class="c1"># Search for specific project</span>
                <span class="n">input_bar</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s1">&#39;ProjectNo&#39;</span><span class="p">)</span>
                <span class="n">input_bar</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">project_number</span><span class="p">)</span>
                <span class="n">input_bar</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>  <span class="c1"># Hit return after sending text</span>

                <span class="c1"># Get content and return result</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_elements_by_class_name</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
                <span class="n">content_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unexpected error for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_number</span><span class="p">),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">result_dictionary</span>

            <span class="k">if</span> <span class="s1">&#39;These plans have NOT been approved for permitting&#39;</span> <span class="ow">in</span> <span class="n">content_list</span><span class="p">:</span>
                <span class="n">result_dictionary</span><span class="p">[</span><span class="n">project_number</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Not approved</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">content_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">result_dictionary</span><span class="p">[</span><span class="n">project_number</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>  <span class="c1"># No data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result_dictionary</span><span class="p">[</span><span class="n">project_number</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Approved</span>

            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Quit browser</span>
        <span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="n">result_dictionary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">result_dictionary</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_dictionary</span>

    <span class="c1"># Use multithreading to do the same thing but faster</span>
    <span class="k">def</span> <span class="nf">speedy_get_project_statuses</span><span class="p">(</span><span class="n">all_project_numbers</span><span class="p">,</span> <span class="n">number_processes</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>

        <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">chunksize</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_project_numbers</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_processes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">def</span> <span class="nf">chunks</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Yield successive n-sized chunks from l.</span>
<span class="sd">            :param l: The list in question</span>
<span class="sd">            :param n: the chunksize.&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">n</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span>

        <span class="n">all_project_numbers_chunked</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chunks</span><span class="p">(</span><span class="n">all_project_numbers</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">))</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">number_processes</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">get_project_statuses</span><span class="p">,</span> <span class="n">all_project_numbers_chunked</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">target_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Took </span><span class="si">{}</span><span class="s1"> seconds for </span><span class="si">{}</span><span class="s1"> project numbers&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_project_numbers</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

        <span class="c1"># Step 1: Get all the unique project numbers</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;structural&#39;</span><span class="p">:</span>
            <span class="n">searchfor</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NEW S.F.&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW SF&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW SINGLE&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW TOWNHOUSE&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW AP&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW HI-&#39;</span><span class="p">]</span> <span class="c1"># All residential buildings</span>
        <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;demolition&#39;</span><span class="p">:</span>
            <span class="n">searchfor</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="c1"># Almost everything is residential demolition, and anyway, commercial demos are included in Dallas</span>

        <span class="n">searchin</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PROJ_DESC&#39;</span><span class="p">]</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;demolition&#39;</span>
        <span class="n">earliest</span> <span class="o">=</span> <span class="mi">2010</span>
        <span class="n">latest</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">houston_permit_data</span> <span class="o">=</span> <span class="n">process_houston_permit_data</span><span class="p">(</span><span class="n">searchfor</span><span class="o">=</span><span class="n">searchfor</span><span class="p">,</span>
                                                          <span class="n">searchin</span><span class="o">=</span><span class="n">searchin</span><span class="p">,</span>
                                                          <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                                                          <span class="n">earliest</span><span class="o">=</span><span class="n">earliest</span><span class="p">,</span>
                                                          <span class="n">latest</span><span class="o">=</span><span class="n">latest</span><span class="p">)</span>

        <span class="n">all_project_numbers</span> <span class="o">=</span> <span class="n">houston_permit_data</span><span class="p">[</span><span class="s1">&#39;PROJECT_NO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># Step 2: Exclude any project numbers for which we already have data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">existing_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">target_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">existing_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">existing_data</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">all_project_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">all_project_numbers</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>  <span class="c1"># In case we don&#39;t already have data</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Note that no pre-existing Houston permit approval data exists - starting from scratch.&#39;</span><span class="p">)</span>
            <span class="k">pass</span>

        <span class="c1"># Step 3: Scrape new stuff</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting to scrape now&#39;</span><span class="p">)</span>
        <span class="n">number_processes</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">speedy_get_project_statuses</span><span class="p">(</span><span class="n">all_project_numbers</span><span class="p">,</span> <span class="n">number_processes</span><span class="o">=</span><span class="n">number_processes</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Asher Spector.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
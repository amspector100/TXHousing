

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TXHousing.data_processing.boundaries &mdash; TXHousing 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> TXHousing
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../utilities.html">Autogenerated Documentation for utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_processing.html">Autogenerated Documentation for data_processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analysis.html">Autogenerated Documentation for analysis package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TXHousing</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>TXHousing.data_processing.boundaries</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for TXHousing.data_processing.boundaries</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Paths and methods for boundary files (uas, csa, counties, blocks, etc)&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">..utilities</span> <span class="k">import</span> <span class="n">simple</span><span class="p">,</span> <span class="n">measurements</span><span class="p">,</span> <span class="n">spatial_joins</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># One exception is that this is needed for utilities, so the places path is listed there.</span>
<span class="n">texas_places_path</span> <span class="o">=</span> <span class="n">measurements</span><span class="o">.</span><span class="n">texas_places_path</span>

<span class="c1"># All other boundaries paths are listed here.</span>
<span class="n">csa_path</span> <span class="o">=</span> <span class="s2">&quot;data/cb_2017_us_csa_500k/cb_2017_us_csa_500k.shp&quot;</span>
<span class="n">cbsa_path</span> <span class="o">=</span>  <span class="s2">&quot;data/cb_2017_us_cbsa_500k/cb_2017_us_cbsa_500k.shp&quot;</span>
<span class="n">ua_path</span> <span class="o">=</span> <span class="s2">&quot;data/cb_2017_us_ua10_500k/cb_2017_us_ua10_500k.shp&quot;</span>

<span class="n">zip_boundaries_path</span> <span class="o">=</span> <span class="s2">&quot;data/cb_2017_us_zcta510_500k/cb_2017_us_zcta510_500k.shp&quot;</span>
<span class="n">county_boundaries_path</span> <span class="o">=</span> <span class="s2">&quot;data/cb_2017_us_county_500k/cb_2017_us_county_500k.shp&quot;</span>
<span class="n">texas_blocks_path</span> <span class="o">=</span> <span class="s2">&quot;data/ACS_2016_5YR_BG_48_TEXAS.gdb&quot;</span>

<span class="c1"># This is the percent of land in each block group that is zoned as residential land. The function below calculates it for</span>
<span class="c1"># Austin and Dallas to improve accuracy of some population-based calculations.</span>
<span class="n">bg_percent_residential_path</span> <span class="o">=</span> <span class="s1">&#39;shared_data/bg_percent_residential.csv&#39;</span>


<div class="viewcode-block" id="Boundaries"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.Boundaries">[docs]</a><span class="k">class</span> <span class="nc">Boundaries</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;A parent class for boundary files (i.e. counties, places, uas). Note that block data has a different __init__</span>
<span class="sd">    method because block data comes as a geodatabase not a shapefile.</span>

<span class="sd">    :param path: The path of the boundaries shapefile.</span>
<span class="sd">    :param crs: Default None. If you cannot read the CRS data from the</span>
<span class="sd">    :param index_col: The column in the shapefile to use as the index. Defaults to None.</span>
<span class="sd">    :param index_type: Change the index to this type, i.e. &#39;str&#39;</span>
<span class="sd">    :param subset_by: Subset by this column. Can be &#39;index&#39; or another column name.</span>
<span class="sd">    :param subset_to: Subset to one of these values.</span>
<span class="sd">    :param bounding_counties: Default None. A list of counties. If not None, __init__ will subset the data</span>
<span class="sd">        to only include boundaries intersecting these counties.</span>
<span class="sd">    :param bounding_polygon: Default None. A shapely polygon. If not None, __init__ will subset the data to only include</span>
<span class="sd">        boundaries intersecting the polygon.</span>
<span class="sd">    :param to_latlong: Default True. Initially tansform data to lat long.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="Boundaries.spatial_subset"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.Boundaries.spatial_subset">[docs]</a>    <span class="k">def</span> <span class="nf">spatial_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polygon</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Given a polygon, will return a subset of self.data which only includes boundaries which intersect the polygon.&quot;&quot;&quot;</span>
        <span class="n">possible_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sindex</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">bounds</span><span class="p">))]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">possible_intersections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">possible_intersections</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">polygon</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">index_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subset_by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subset_to</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">bounding_counties</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bounding_polygon</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">to_latlong</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

        <span class="c1"># Read data, get sindex, crs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No CRS provided for boundaries data at </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">to_latlong</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_crs</span><span class="p">({</span><span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sindex</span>

        <span class="c1"># Set index and subset</span>
        <span class="k">if</span> <span class="n">index_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index_col</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">index_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">index_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subset_by</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">subset_to</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">subset_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">subset_by</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">subset_to</span><span class="p">)]</span>

        <span class="c1"># Spatial subsets</span>
        <span class="k">if</span> <span class="n">bounding_polygon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_subset</span><span class="p">(</span><span class="n">bounding_polygon</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bounding_counties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">counties</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">county_boundaries_path</span><span class="p">)</span>
            <span class="n">county_shape</span> <span class="o">=</span> <span class="n">counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">counties</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bounding_counties</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">counties</span><span class="p">[</span><span class="s1">&#39;STATEFP&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;48&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span><span class="o">.</span><span class="n">unary_union</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_subset</span><span class="p">(</span><span class="n">county_shape</span><span class="p">)</span>

<div class="viewcode-block" id="Boundaries.type_of_external_gdf"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.Boundaries.type_of_external_gdf">[docs]</a>    <span class="k">def</span> <span class="nf">type_of_external_gdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">geometry_column</span> <span class="o">=</span> <span class="s1">&#39;geometry&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Figures out the type of geometry (point or polygon) of a gdf and raises an error if it&#39;s mixed&quot;&quot;&quot;</span>

        <span class="n">geom_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="n">geometry_column</span><span class="p">]</span><span class="o">.</span><span class="n">geom_type</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">geom_types</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">geom_types</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Polygon&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiPolygon&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">geom_types</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiPoint&#39;</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot handle mixed geometry types of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_types</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;Polygon&#39;</span> <span class="ow">in</span> <span class="n">geom_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Polygon&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;Point&#39;</span> <span class="ow">in</span> <span class="n">geom_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Point&#39;</span></div>

<div class="viewcode-block" id="Boundaries.process_external_gdf"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.Boundaries.process_external_gdf">[docs]</a>    <span class="k">def</span> <span class="nf">process_external_gdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">geometry_column</span> <span class="o">=</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes external gdf&#39;s geometry/crs. Passes kwargs to process_geometry or process_points call.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get rid of invalid geometries</span>
        <span class="n">geometry_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_external_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">:</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">process_geometry</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">geometry_column</span> <span class="o">=</span> <span class="n">geometry_column</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">process_points</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">geometry_column</span> <span class="o">=</span> <span class="n">geometry_column</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Process crs</span>
        <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Boundaries object assuming external gdf data is in </span><span class="si">{}</span><span class="s1"> because no crs is given&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">crs</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">crs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Boundaries object forced to transform external gdf data to new coordinate system&#39;</span><span class="p">)</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gdf</span></div>


<div class="viewcode-block" id="Boundaries.fast_intersection"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.Boundaries.fast_intersection">[docs]</a>    <span class="k">def</span> <span class="nf">fast_intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">geometry_column</span> <span class="o">=</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Given a gdf of polygons or points, will calculate which boundary each polygon/point lies inside. Assumes that</span>
<span class="sd">        if the gdf is full of polygon data, each polygon will only intersect a single zip code.</span>

<span class="sd">        :param gdf: A geodataframe, in the same crs as the boundaries data.</span>
<span class="sd">        :param geometry_column: The geometry column of the gdf.</span>
<span class="sd">        :param kwargs: kwargs to pass to the underlying fast_polygon_intersection or points_intersect_multiple_polygons</span>
<span class="sd">            functions.</span>
<span class="sd">        :return: A pandas series mapping the index of the gdf to the indexes/names of the boundaries. If an index does not</span>
<span class="sd">            appear in the returned series, that is because the point/polygon for that index did not lie inside any of</span>
<span class="sd">            the boundaries polygons.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If the user is passing in a spatial index, do not process the data because this will cause index errors</span>
        <span class="k">if</span> <span class="s1">&#39;points_spatial_index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s1">&#39;small_points_spatial_index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_external_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">geometry_column</span> <span class="o">=</span> <span class="n">geometry_column</span><span class="p">)</span>

        <span class="n">geometry_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_of_external_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">spatial_joins</span><span class="o">.</span><span class="n">fast_polygon_intersection</span><span class="p">(</span><span class="n">small_polygon_gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">large_polygon_gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                             <span class="n">small_geometry_column</span> <span class="o">=</span> <span class="n">geometry_column</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">elif</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">spatial_joins</span><span class="o">.</span><span class="n">points_intersect_multiple_polygons</span><span class="p">(</span><span class="n">points_gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                                      <span class="n">points_geometry_column</span> <span class="o">=</span> <span class="n">geometry_column</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;gdf geometry must be a shapely point or polygon&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Boundaries.push_features"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.Boundaries.push_features">[docs]</a>    <span class="k">def</span> <span class="nf">push_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">geometry_column</span> <span class="o">=</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Given features in boundaries data, this &quot;pushes&quot; or calculates those features for another gdf of other (usually</span>
<span class="sd">        smaller) polygons. This is effectively a slower alternative to the fast_intersection method.</span>

<span class="sd">        :param GeoDataFrame gdf: A geodataframe of polygon geometry.</span>
<span class="sd">        :param features: The factors to calculate</span>
<span class="sd">        :param geometry_column: The geometry column of the gdf.</span>
<span class="sd">        :param kwargs: kwargs to pass to the underlying get_averages_by_area function.</span>
<span class="sd">        :return: The gdf but with &#39;factors&#39; columns.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_external_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">geometry_column</span> <span class="o">=</span> <span class="n">geometry_column</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">spatial_joins</span><span class="o">.</span><span class="n">get_averages_by_area</span><span class="p">(</span><span class="n">data_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">other_geometries</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="p">,</span>
                                                    <span class="n">other_geometries_column</span> <span class="o">=</span> <span class="n">geometry_column</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Boundaries.pull_features"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.Boundaries.pull_features">[docs]</a>    <span class="k">def</span> <span class="nf">pull_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">geometry_column</span> <span class="o">=</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Given features in a non-boundaries gdf, this &quot;pulls&quot; or calculates those features for the boundary data attribute.</span>
<span class="sd">        This a slower alternative to the fast_intersection method.</span>

<span class="sd">        :param GeoDataFrame gdf: A geodataframe of polygon geometry.</span>
<span class="sd">        :param features: The factors to calculate from the gdf.</span>
<span class="sd">        :param geometry_column: The geometry column of the gdf.</span>
<span class="sd">        :param kwargs: kwargs to pass to the underlying get_averages_by_area function.</span>
<span class="sd">        :return: None but modifies self.data so that it has &#39;factors&#39; columns.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spatial_joins</span><span class="o">.</span><span class="n">get_averages_by_area</span><span class="p">(</span><span class="n">data_source</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">other_geometries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="p">,</span>
                                                    <span class="n">other_geometries_column</span> <span class="o">=</span> <span class="n">geometry_column</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZipBoundaries"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.ZipBoundaries">[docs]</a><span class="k">class</span> <span class="nc">ZipBoundaries</span><span class="p">(</span><span class="n">Boundaries</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class for Zipcode Boundaries Data, wraps Boundaries class. You cannot pass subset_by or subset if you pass the</span>
<span class="sd">    ziplist parameter, but otherwise all the init parameters are the same.</span>

<span class="sd">     :param ziplist: A list of zipcodes to subset to.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ziplist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bounding_counties</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bounding_polygon</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># Put zips as strings</span>
        <span class="k">if</span> <span class="n">ziplist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ziplist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ziplist</span><span class="p">))</span>
            <span class="n">subset_by</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subset_by</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ziplist</span> <span class="o">=</span> <span class="n">ziplist</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bounding_counties</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">bounding_counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">bounding_counties</span><span class="p">]</span>


        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">zip_boundaries_path</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="s1">&#39;ZCTA5CE10&#39;</span><span class="p">,</span> <span class="n">index_type</span> <span class="o">=</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="n">subset_by</span> <span class="o">=</span> <span class="n">subset_by</span><span class="p">,</span>
                         <span class="n">subset_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ziplist</span><span class="p">,</span> <span class="n">bounding_counties</span><span class="o">=</span><span class="n">bounding_counties</span><span class="p">,</span> <span class="n">bounding_polygon</span><span class="o">=</span><span class="n">bounding_polygon</span><span class="p">)</span>

<div class="viewcode-block" id="ZipBoundaries.add_property_data"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.ZipBoundaries.add_property_data">[docs]</a>    <span class="k">def</span> <span class="nf">add_property_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">property_input</span><span class="p">,</span> <span class="n">features</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add demand features from realtor/zillow inputs</span>

<span class="sd">        :param demand_input: A property_input class</span>
<span class="sd">        :param features: Optional features to subset to</span>
<span class="sd">        :param kwargs: **kwargs to pass to the .join method. Often useful to pass a rsuffix to prevent ValueErrors.</span>
<span class="sd">        :return: None, but changes self.data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">property_data</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">property_input</span><span class="o">.</span><span class="n">process_property_data</span><span class="p">(</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="p">,</span> <span class="n">geo_filter_values</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="n">property_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">property_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">property_data</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="BlockBoundaries"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.BlockBoundaries">[docs]</a><span class="k">class</span> <span class="nc">BlockBoundaries</span><span class="p">(</span><span class="n">Boundaries</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class for block data, wraps Boundaries class, with a substantially different init method. After initialization,</span>
<span class="sd">    self.data is a gdf with a &#39;geometry&#39; column, a variety of block data columns, and if cities is not None, it has a</span>
<span class="sd">    &#39;place&#39; column as well.</span>

<span class="sd">    :param data_layers: Iterable of codes for the data layer of the geodatabase.</span>
<span class="sd">    :param cities: City name (i.e. &#39;Austin&#39;), or iterable of city names to filter by (i.e. [&#39;Austin&#39;, &#39;Dallas&#39;].</span>
<span class="sd">        Need to be in Texas or this won&#39;t work. Defaults to None.</span>
<span class="sd">   &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_layers</span><span class="p">,</span> <span class="n">cities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">get_percent_residential</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

        <span class="c1"># Merge layers from geodatabase - this is a pretty cheap operation, relatively speaking (10 sec or so)</span>
        <span class="n">geodata</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">texas_blocks_path</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;ACS_2016_5YR_BG_48_TEXAS&#39;</span><span class="p">)</span>
        <span class="n">geodata</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodata</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">geodata</span><span class="p">[</span><span class="s1">&#39;real_geometry_column&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodata</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">data_layer</span> <span class="ow">in</span> <span class="n">data_layers</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">texas_blocks_path</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">data_layer</span><span class="p">)</span>
            <span class="n">geodata</span> <span class="o">=</span> <span class="n">geodata</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;GEOID_Data&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;GEOID&#39;</span><span class="p">)</span>
            <span class="n">geodata</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;GEOID_y&#39;</span><span class="p">:</span> <span class="s1">&#39;GEOID&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">geodata</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;GEOID&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get the percent of land which is zoned residential inside the city limits</span>
        <span class="k">if</span> <span class="n">get_percent_residential</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bg_percent_residential_path</span><span class="p">):</span>
                <span class="n">percent_residential</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">bg_percent_residential_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">percent_residential</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;percent_residential&#39;</span><span class="p">]</span>
                <span class="n">geodata</span> <span class="o">=</span> <span class="n">geodata</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">percent_residential</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Cannot retrieve percent_residential for block data because percent_residential data has not been cached&#39;</span><span class="p">)</span>

        <span class="n">geodata</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">geodata</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">geodata</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;real_geometry_column&#39;</span><span class="p">]],</span>
                                   <span class="n">geometry</span><span class="o">=</span><span class="n">geodata</span><span class="p">[</span><span class="s1">&#39;real_geometry_column&#39;</span><span class="p">])</span> <span class="c1"># This automatically renames the columns</span>
        <span class="n">geodata</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;epsg:4326&#39;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">cities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cities</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">cities</span> <span class="o">=</span> <span class="p">[</span><span class="n">cities</span><span class="p">]</span>

            <span class="c1"># Only consider blocks in cities</span>
            <span class="n">place_shapes</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">texas_places_path</span><span class="p">)</span>
            <span class="n">place_shapes</span> <span class="o">=</span> <span class="n">place_shapes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">place_shapes</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cities</span><span class="p">)]</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="n">spatial_joins</span><span class="o">.</span><span class="n">fast_polygon_intersection</span><span class="p">(</span><span class="n">geodata</span><span class="p">,</span> <span class="n">place_shapes</span><span class="p">,</span> <span class="n">large_name_column</span> <span class="o">=</span> <span class="s1">&#39;NAME&#39;</span><span class="p">)</span>
            <span class="n">geodata</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>
            <span class="n">geodata</span> <span class="o">=</span> <span class="n">geodata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">geodata</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">geodata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sindex</span> <span class="o">=</span> <span class="n">geodata</span><span class="o">.</span><span class="n">sindex</span></div>

<div class="viewcode-block" id="calc_percent_residential_in_block_groups"><a class="viewcode-back" href="../../../data_processing.html#TXHousing.data_processing.boundaries.calc_percent_residential_in_block_groups">[docs]</a><span class="k">def</span> <span class="nf">calc_percent_residential_in_block_groups</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Calculates the percent zoned as residential in each block group. Should be run in the setup.py. This has been</span>
<span class="sd">    tested for accuracy but is not in the unittests.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">zoning</span>

    <span class="c1"># Get block and zoning data</span>
    <span class="n">block_data</span> <span class="o">=</span> <span class="n">BlockBoundaries</span><span class="p">(</span><span class="n">data_layers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X19_INCOME&#39;</span><span class="p">],</span> <span class="n">cities</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Austin&#39;</span><span class="p">,</span> <span class="s1">&#39;Dallas&#39;</span><span class="p">],</span> <span class="n">get_percent_residential</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">austin_block_data</span> <span class="o">=</span> <span class="n">block_data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">block_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Austin&#39;</span><span class="p">]</span>
    <span class="n">dallas_block_data</span> <span class="o">=</span> <span class="n">block_data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">block_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Dallas&#39;</span><span class="p">]</span>

    <span class="c1"># Get zone data and simplify for performance. Note zone data is a geoseries not a geodataframe.</span>
    <span class="n">dallas_zones</span> <span class="o">=</span> <span class="n">zoning</span><span class="o">.</span><span class="n">dallas_inputs</span><span class="o">.</span><span class="n">process_zoning_shapefile</span><span class="p">()</span>
    <span class="n">dallas_zones</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">process_geometry</span><span class="p">(</span><span class="n">dallas_zones</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dallas_zones</span><span class="p">[</span><span class="s1">&#39;broad_zone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Single Family&#39;</span><span class="p">,</span> <span class="s1">&#39;Multifamily&#39;</span><span class="p">])])</span>
    <span class="n">austin_zones</span> <span class="o">=</span> <span class="n">zoning</span><span class="o">.</span><span class="n">austin_inputs</span><span class="o">.</span><span class="n">process_zoning_shapefile</span><span class="p">()</span>
    <span class="n">austin_zones</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">process_geometry</span><span class="p">(</span><span class="n">austin_zones</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">austin_zones</span><span class="p">[</span><span class="s1">&#39;broad_zone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Single Family&#39;</span><span class="p">,</span> <span class="s1">&#39;Multifamily&#39;</span><span class="p">])])</span>

    <span class="c1"># Now find intersections</span>
    <span class="k">for</span> <span class="n">cityname</span><span class="p">,</span> <span class="n">block_data</span><span class="p">,</span> <span class="n">zone_data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;Dallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Austin&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">dallas_block_data</span><span class="p">,</span> <span class="n">austin_block_data</span><span class="p">],</span> <span class="p">[</span><span class="n">dallas_zones</span><span class="p">,</span> <span class="n">austin_zones</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting to work on </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cityname</span><span class="p">))</span>
        <span class="n">spatial_index</span> <span class="o">=</span> <span class="n">zone_data</span><span class="o">.</span><span class="n">sindex</span>
        <span class="n">block_data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span>

        <span class="k">def</span> <span class="nf">calc_percent_res</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
            <span class="n">percent_residential</span> <span class="o">=</span> <span class="n">spatial_joins</span><span class="o">.</span><span class="n">polygons_intersect_single_polygon</span><span class="p">(</span><span class="n">zone_data</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">spatial_index</span><span class="p">,</span> <span class="n">factors</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">account_for_area</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">horiz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">vert</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">percent_residential</span>

        <span class="n">block_data</span><span class="p">[</span><span class="s1">&#39;percent_residential&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calc_percent_res</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">austin_block_data</span><span class="p">[</span><span class="s1">&#39;percent_residential&#39;</span><span class="p">],</span> <span class="n">dallas_block_data</span><span class="p">[</span><span class="s1">&#39;percent_residential&#39;</span><span class="p">]])</span>
    <span class="n">results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">bg_percent_residential_path</span><span class="p">)</span></div>

<span class="n">austin_zips</span> <span class="o">=</span> <span class="p">[</span><span class="mi">73301</span><span class="p">,</span> <span class="mi">73344</span><span class="p">,</span> <span class="mi">78704</span><span class="p">,</span> <span class="mi">78705</span><span class="p">,</span> <span class="mi">78708</span><span class="p">,</span> <span class="mi">78713</span><span class="p">,</span> <span class="mi">78714</span><span class="p">,</span> <span class="mi">78715</span><span class="p">,</span> <span class="mi">78701</span><span class="p">,</span> <span class="mi">78702</span><span class="p">,</span> <span class="mi">78703</span><span class="p">,</span> <span class="mi">78709</span><span class="p">,</span> <span class="mi">78710</span><span class="p">,</span> <span class="mi">78711</span><span class="p">,</span> <span class="mi">78712</span><span class="p">,</span>
<span class="mi">78716</span><span class="p">,</span> <span class="mi">78717</span><span class="p">,</span> <span class="mi">78718</span><span class="p">,</span> <span class="mi">78719</span><span class="p">,</span> <span class="mi">78720</span><span class="p">,</span> <span class="mi">78721</span><span class="p">,</span> <span class="mi">78722</span><span class="p">,</span> <span class="mi">78723</span><span class="p">,</span> <span class="mi">78728</span><span class="p">,</span> <span class="mi">78729</span><span class="p">,</span> <span class="mi">78730</span><span class="p">,</span> <span class="mi">78731</span><span class="p">,</span> <span class="mi">78734</span><span class="p">,</span> <span class="mi">78724</span><span class="p">,</span> <span class="mi">78725</span><span class="p">,</span> <span class="mi">78726</span><span class="p">,</span> <span class="mi">78727</span><span class="p">,</span>
<span class="mi">78732</span><span class="p">,</span> <span class="mi">78733</span><span class="p">,</span> <span class="mi">78735</span><span class="p">,</span> <span class="mi">78736</span><span class="p">,</span> <span class="mi">78739</span><span class="p">,</span> <span class="mi">78741</span><span class="p">,</span> <span class="mi">78745</span><span class="p">,</span> <span class="mi">78746</span><span class="p">,</span> <span class="mi">78749</span><span class="p">,</span> <span class="mi">78750</span><span class="p">,</span> <span class="mi">78751</span><span class="p">,</span> <span class="mi">78752</span><span class="p">,</span> <span class="mi">78755</span><span class="p">,</span> <span class="mi">78756</span><span class="p">,</span> <span class="mi">78757</span><span class="p">,</span> <span class="mi">78758</span><span class="p">,</span> <span class="mi">78759</span><span class="p">,</span>
<span class="mi">78737</span><span class="p">,</span> <span class="mi">78738</span><span class="p">,</span> <span class="mi">78742</span><span class="p">,</span> <span class="mi">78744</span><span class="p">,</span> <span class="mi">78747</span><span class="p">,</span> <span class="mi">78748</span><span class="p">,</span> <span class="mi">78753</span><span class="p">,</span> <span class="mi">78754</span><span class="p">,</span> <span class="mi">78760</span><span class="p">,</span> <span class="mi">78761</span><span class="p">,</span> <span class="mi">78762</span><span class="p">,</span> <span class="mi">78763</span><span class="p">,</span> <span class="mi">78769</span><span class="p">,</span> <span class="mi">78772</span><span class="p">,</span> <span class="mi">78773</span><span class="p">,</span> <span class="mi">78780</span><span class="p">,</span> <span class="mi">78781</span><span class="p">,</span>
<span class="mi">78799</span><span class="p">,</span> <span class="mi">78764</span><span class="p">,</span> <span class="mi">78765</span><span class="p">,</span> <span class="mi">78766</span><span class="p">,</span> <span class="mi">78767</span><span class="p">,</span> <span class="mi">78768</span><span class="p">,</span> <span class="mi">78774</span><span class="p">,</span> <span class="mi">78778</span><span class="p">,</span> <span class="mi">78779</span><span class="p">,</span> <span class="mi">78783</span><span class="p">,</span> <span class="mi">78785</span><span class="p">,</span> <span class="mi">78789</span><span class="p">]</span>
<span class="n">austin_zips</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">austin_zips</span><span class="p">]</span>
<span class="n">dallas_zips</span> <span class="o">=</span> <span class="p">[</span><span class="mi">75203</span><span class="p">,</span> <span class="mi">75204</span><span class="p">,</span> <span class="mi">75205</span><span class="p">,</span> <span class="mi">75208</span><span class="p">,</span> <span class="mi">75209</span><span class="p">,</span> <span class="mi">75210</span><span class="p">,</span> <span class="mi">75211</span><span class="p">,</span> <span class="mi">75212</span><span class="p">,</span> <span class="mi">75214</span><span class="p">,</span> <span class="mi">75201</span><span class="p">,</span> <span class="mi">75202</span><span class="p">,</span> <span class="mi">75206</span><span class="p">,</span> <span class="mi">75207</span><span class="p">,</span> <span class="mi">75215</span><span class="p">,</span> <span class="mi">75216</span><span class="p">,</span>
<span class="mi">75217</span><span class="p">,</span> <span class="mi">75218</span><span class="p">,</span> <span class="mi">75222</span><span class="p">,</span> <span class="mi">75223</span><span class="p">,</span> <span class="mi">75224</span><span class="p">,</span> <span class="mi">75225</span><span class="p">,</span> <span class="mi">75230</span><span class="p">,</span> <span class="mi">75231</span><span class="p">,</span> <span class="mi">75232</span><span class="p">,</span> <span class="mi">75233</span><span class="p">,</span> <span class="mi">75236</span><span class="p">,</span> <span class="mi">75237</span><span class="p">,</span> <span class="mi">75238</span><span class="p">,</span> <span class="mi">75240</span><span class="p">,</span> <span class="mi">75246</span><span class="p">,</span> <span class="mi">75251</span><span class="p">,</span> <span class="mi">75252</span><span class="p">,</span>
<span class="mi">75253</span><span class="p">,</span> <span class="mi">75219</span><span class="p">,</span> <span class="mi">75220</span><span class="p">,</span> <span class="mi">75221</span><span class="p">,</span> <span class="mi">75226</span><span class="p">,</span> <span class="mi">75227</span><span class="p">,</span> <span class="mi">75228</span><span class="p">,</span> <span class="mi">75229</span><span class="p">,</span> <span class="mi">75234</span><span class="p">,</span> <span class="mi">75235</span><span class="p">,</span> <span class="mi">75241</span><span class="p">,</span> <span class="mi">75242</span><span class="p">,</span> <span class="mi">75243</span><span class="p">,</span> <span class="mi">75244</span><span class="p">,</span> <span class="mi">75247</span><span class="p">,</span> <span class="mi">75248</span><span class="p">,</span> <span class="mi">75249</span><span class="p">,</span>
<span class="mi">75250</span><span class="p">,</span> <span class="mi">75254</span><span class="p">,</span> <span class="mi">75260</span><span class="p">,</span> <span class="mi">75261</span><span class="p">,</span> <span class="mi">75265</span><span class="p">,</span> <span class="mi">75266</span><span class="p">,</span> <span class="mi">75267</span><span class="p">,</span> <span class="mi">75270</span><span class="p">,</span> <span class="mi">75275</span><span class="p">,</span> <span class="mi">75284</span><span class="p">,</span> <span class="mi">75285</span><span class="p">,</span> <span class="mi">75262</span><span class="p">,</span> <span class="mi">75263</span><span class="p">,</span> <span class="mi">75264</span><span class="p">,</span> <span class="mi">75277</span><span class="p">,</span> <span class="mi">75283</span><span class="p">,</span> <span class="mi">75287</span><span class="p">,</span>
<span class="mi">75301</span><span class="p">,</span> <span class="mi">75315</span><span class="p">,</span> <span class="mi">75320</span><span class="p">,</span> <span class="mi">75326</span><span class="p">,</span> <span class="mi">75355</span><span class="p">,</span> <span class="mi">75356</span><span class="p">,</span> <span class="mi">75357</span><span class="p">,</span> <span class="mi">75358</span><span class="p">,</span> <span class="mi">75370</span><span class="p">,</span> <span class="mi">75371</span><span class="p">,</span> <span class="mi">75372</span><span class="p">,</span> <span class="mi">75373</span><span class="p">,</span> <span class="mi">75381</span><span class="p">,</span> <span class="mi">75382</span><span class="p">,</span> <span class="mi">75389</span><span class="p">,</span> <span class="mi">75390</span><span class="p">,</span> <span class="mi">75393</span><span class="p">,</span>
<span class="mi">75394</span><span class="p">,</span> <span class="mi">75395</span><span class="p">,</span> <span class="mi">75303</span><span class="p">,</span> <span class="mi">75312</span><span class="p">,</span> <span class="mi">75313</span><span class="p">,</span> <span class="mi">75336</span><span class="p">,</span> <span class="mi">75339</span><span class="p">,</span> <span class="mi">75342</span><span class="p">,</span> <span class="mi">75354</span><span class="p">,</span> <span class="mi">75359</span><span class="p">,</span> <span class="mi">75360</span><span class="p">,</span> <span class="mi">75367</span><span class="p">,</span> <span class="mi">75368</span><span class="p">,</span> <span class="mi">75374</span><span class="p">,</span> <span class="mi">75376</span><span class="p">,</span> <span class="mi">75378</span><span class="p">,</span> <span class="mi">75379</span><span class="p">,</span>
<span class="mi">75380</span><span class="p">,</span> <span class="mi">75391</span><span class="p">,</span> <span class="mi">75392</span><span class="p">,</span> <span class="mi">75397</span><span class="p">,</span> <span class="mi">75398</span><span class="p">]</span>
<span class="n">dallas_zips</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">dallas_zips</span><span class="p">]</span>
<span class="n">houston_zips</span> <span class="o">=</span> <span class="p">[</span><span class="mi">77002</span><span class="p">,</span> <span class="mi">77003</span><span class="p">,</span> <span class="mi">77004</span><span class="p">,</span> <span class="mi">77005</span><span class="p">,</span> <span class="mi">77006</span><span class="p">,</span> <span class="mi">77007</span><span class="p">,</span> <span class="mi">77008</span><span class="p">,</span> <span class="mi">77009</span><span class="p">,</span> <span class="mi">77010</span><span class="p">,</span> <span class="mi">77011</span><span class="p">,</span> <span class="mi">77012</span><span class="p">,</span> <span class="mi">77013</span><span class="p">,</span> <span class="mi">77014</span><span class="p">,</span> <span class="mi">77015</span><span class="p">,</span> <span class="mi">77016</span><span class="p">,</span>
                <span class="mi">77017</span><span class="p">,</span> <span class="mi">77018</span><span class="p">,</span> <span class="mi">77019</span><span class="p">,</span> <span class="mi">77020</span><span class="p">,</span> <span class="mi">77021</span><span class="p">,</span> <span class="mi">77022</span><span class="p">,</span> <span class="mi">77023</span><span class="p">,</span> <span class="mi">77024</span><span class="p">,</span> <span class="mi">77025</span><span class="p">,</span> <span class="mi">77026</span><span class="p">,</span> <span class="mi">77027</span><span class="p">,</span> <span class="mi">77028</span><span class="p">,</span> <span class="mi">77029</span><span class="p">,</span> <span class="mi">77030</span><span class="p">,</span> <span class="mi">77031</span><span class="p">,</span>
                <span class="mi">77032</span><span class="p">,</span> <span class="mi">77033</span><span class="p">,</span> <span class="mi">77034</span><span class="p">,</span> <span class="mi">77035</span><span class="p">,</span> <span class="mi">77036</span><span class="p">,</span> <span class="mi">77037</span><span class="p">,</span> <span class="mi">77038</span><span class="p">,</span> <span class="mi">77039</span><span class="p">,</span> <span class="mi">77040</span><span class="p">,</span> <span class="mi">77041</span><span class="p">,</span> <span class="mi">77042</span><span class="p">,</span> <span class="mi">77043</span><span class="p">,</span> <span class="mi">77044</span><span class="p">,</span> <span class="mi">77045</span><span class="p">,</span> <span class="mi">77046</span><span class="p">,</span>
                <span class="mi">77047</span><span class="p">,</span> <span class="mi">77048</span><span class="p">,</span> <span class="mi">77049</span><span class="p">,</span> <span class="mi">77050</span><span class="p">,</span> <span class="mi">77051</span><span class="p">,</span> <span class="mi">77053</span><span class="p">,</span> <span class="mi">77054</span><span class="p">,</span> <span class="mi">77055</span><span class="p">,</span> <span class="mi">77056</span><span class="p">,</span> <span class="mi">77057</span><span class="p">,</span> <span class="mi">77058</span><span class="p">,</span> <span class="mi">77059</span><span class="p">,</span> <span class="mi">77060</span><span class="p">,</span> <span class="mi">77061</span><span class="p">,</span> <span class="mi">77062</span><span class="p">,</span>
                <span class="mi">77063</span><span class="p">,</span> <span class="mi">77064</span><span class="p">,</span> <span class="mi">77065</span><span class="p">,</span> <span class="mi">77066</span><span class="p">,</span> <span class="mi">77067</span><span class="p">,</span> <span class="mi">77068</span><span class="p">,</span> <span class="mi">77069</span><span class="p">,</span> <span class="mi">77070</span><span class="p">,</span> <span class="mi">77071</span><span class="p">,</span> <span class="mi">77072</span><span class="p">,</span> <span class="mi">77073</span><span class="p">,</span> <span class="mi">77074</span><span class="p">,</span> <span class="mi">77075</span><span class="p">,</span> <span class="mi">77076</span><span class="p">,</span> <span class="mi">77077</span><span class="p">,</span>
                <span class="mi">77078</span><span class="p">,</span> <span class="mi">77079</span><span class="p">,</span> <span class="mi">77080</span><span class="p">,</span> <span class="mi">77081</span><span class="p">,</span> <span class="mi">77082</span><span class="p">,</span> <span class="mi">77083</span><span class="p">,</span> <span class="mi">77084</span><span class="p">,</span> <span class="mi">77085</span><span class="p">,</span> <span class="mi">77086</span><span class="p">,</span> <span class="mi">77087</span><span class="p">,</span> <span class="mi">77088</span><span class="p">,</span> <span class="mi">77089</span><span class="p">,</span> <span class="mi">77090</span><span class="p">,</span> <span class="mi">77091</span><span class="p">,</span> <span class="mi">77092</span><span class="p">,</span>
                <span class="mi">77093</span><span class="p">,</span> <span class="mi">77094</span><span class="p">,</span> <span class="mi">77095</span><span class="p">,</span> <span class="mi">77096</span><span class="p">,</span> <span class="mi">77098</span><span class="p">,</span> <span class="mi">77099</span><span class="p">,</span> <span class="mi">77201</span><span class="p">,</span> <span class="mi">77336</span><span class="p">,</span> <span class="mi">77338</span><span class="p">,</span> <span class="mi">77339</span><span class="p">,</span> <span class="mi">77345</span><span class="p">,</span> <span class="mi">77346</span><span class="p">,</span> <span class="mi">77357</span><span class="p">,</span> <span class="mi">77365</span><span class="p">,</span> <span class="mi">77373</span><span class="p">,</span>
                <span class="mi">77375</span><span class="p">,</span> <span class="mi">77377</span><span class="p">,</span> <span class="mi">77379</span><span class="p">,</span> <span class="mi">77386</span><span class="p">,</span> <span class="mi">77388</span><span class="p">,</span> <span class="mi">77396</span><span class="p">,</span> <span class="mi">77401</span><span class="p">,</span> <span class="mi">77406</span><span class="p">,</span> <span class="mi">77407</span><span class="p">,</span> <span class="mi">77429</span><span class="p">,</span> <span class="mi">77433</span><span class="p">,</span> <span class="mi">77447</span><span class="p">,</span> <span class="mi">77449</span><span class="p">,</span> <span class="mi">77450</span><span class="p">,</span> <span class="mi">77477</span><span class="p">,</span>
                <span class="mi">77478</span><span class="p">,</span> <span class="mi">77484</span><span class="p">,</span> <span class="mi">77489</span><span class="p">,</span> <span class="mi">77493</span><span class="p">,</span> <span class="mi">77494</span><span class="p">,</span> <span class="mi">77498</span><span class="p">,</span> <span class="mi">77503</span><span class="p">,</span> <span class="mi">77504</span><span class="p">,</span> <span class="mi">77506</span><span class="p">,</span> <span class="mi">77520</span><span class="p">,</span> <span class="mi">77530</span><span class="p">,</span> <span class="mi">77532</span><span class="p">,</span> <span class="mi">77536</span><span class="p">,</span> <span class="mi">77546</span><span class="p">,</span> <span class="mi">77547</span><span class="p">,</span>
                <span class="mi">77571</span><span class="p">,</span> <span class="mi">77587</span><span class="p">,</span> <span class="mi">77598</span><span class="p">]</span>
<span class="n">houston_zips</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">houston_zips</span><span class="p">]</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Asher Spector.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>